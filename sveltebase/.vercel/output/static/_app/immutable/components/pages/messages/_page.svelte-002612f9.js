import{S as z,i as B,s as H,k as M,a as L,q as T,l as k,m as E,h as y,c as O,r as V,n as b,b as q,F as _,R as C,H as F,T as j,M as J,C as U,U as K,G as Q,o as W,O as X,P as G,u as N,V as Y,x as Z,y as ee,z as te,f as se,t as ae,A as le}from"../../../chunks/index-54554715.js";import{c as ne,p as P}from"../../../chunks/pocketbase-ad6b1b08.js";function R(u,s,e){const a=u.slice();return a[6]=s[e],a}function $(u,s){var m,I;let e,a,i,r,l,d,h,o=((I=(m=s[6].expand)==null?void 0:m.user)==null?void 0:I.username)+"",g,v,c,w=s[6].text+"",t,n;return{key:u,first:null,c(){e=M("div"),a=M("img"),r=L(),l=M("div"),d=M("small"),h=T("Sent by @"),g=T(o),v=L(),c=M("p"),t=T(w),n=L(),this.h()},l(p){e=k(p,"DIV",{class:!0});var f=E(e);a=k(f,"IMG",{class:!0,src:!0,alt:!0,width:!0}),r=O(f),l=k(f,"DIV",{});var x=E(l);d=k(x,"SMALL",{});var S=E(d);h=V(S,"Sent by @"),g=V(S,o),S.forEach(y),v=O(x),c=k(x,"P",{class:!0});var D=E(c);t=V(D,w),D.forEach(y),x.forEach(y),n=O(f),f.forEach(y),this.h()},h(){var p,f;b(a,"class","avatar"),G(a.src,i=`https://avatars.dicebear.com/api/identicon/${(f=(p=s[6].expand)==null?void 0:p.user)==null?void 0:f.username}.svg`)||b(a,"src",i),b(a,"alt","avatar"),b(a,"width","40px"),b(c,"class","msg-text"),b(e,"class","msg"),this.first=e},m(p,f){q(p,e,f),_(e,a),_(e,r),_(e,l),_(l,d),_(d,h),_(d,g),_(l,v),_(l,c),_(c,t),_(e,n)},p(p,f){var x,S,D,A;s=p,f&2&&!G(a.src,i=`https://avatars.dicebear.com/api/identicon/${(S=(x=s[6].expand)==null?void 0:x.user)==null?void 0:S.username}.svg`)&&b(a,"src",i),f&2&&o!==(o=((A=(D=s[6].expand)==null?void 0:D.user)==null?void 0:A.username)+"")&&N(g,o),f&2&&w!==(w=s[6].text+"")&&N(t,w)},d(p){p&&y(e)}}}function re(u){let s,e=[],a=new Map,i,r,l,d,h,o,g,v,c=u[1];const w=t=>t[6].id;for(let t=0;t<c.length;t+=1){let n=R(u,c,t),m=w(n);a.set(m,e[t]=$(m,n))}return{c(){s=M("div");for(let t=0;t<e.length;t+=1)e[t].c();i=L(),r=M("form"),l=M("input"),d=L(),h=M("button"),o=T("Send"),this.h()},l(t){s=k(t,"DIV",{class:!0});var n=E(s);for(let p=0;p<e.length;p+=1)e[p].l(n);n.forEach(y),i=O(t),r=k(t,"FORM",{});var m=E(r);l=k(m,"INPUT",{placeholder:!0,type:!0}),d=O(m),h=k(m,"BUTTON",{type:!0});var I=E(h);o=V(I,"Send"),I.forEach(y),m.forEach(y),this.h()},h(){b(s,"class","messages"),b(l,"placeholder","Message"),b(l,"type","text"),b(h,"type","submit")},m(t,n){q(t,s,n);for(let m=0;m<e.length;m+=1)e[m].m(s,null);q(t,i,n),q(t,r,n),_(r,l),C(l,u[0]),_(r,d),_(r,h),_(h,o),g||(v=[F(l,"input",u[3]),F(r,"submit",j(u[2]))],g=!0)},p(t,[n]){n&2&&(c=t[1],e=J(e,n,w,1,t,c,a,s,Y,$,null,R)),n&1&&l.value!==t[0]&&C(l,t[0])},i:U,o:U,d(t){t&&y(s);for(let n=0;n<e.length;n+=1)e[n].d();t&&y(i),t&&y(r),g=!1,K(v)}}}function ie(u,s,e){let a;Q(u,ne,o=>e(5,a=o));let i,r=[],l;W(async()=>{const o=await P.collection("messages").getList(1,50,{sort:"created",expand:"user"});e(1,r=o.items),l=await P.collection("messages").subscribe("*",async({action:g,record:v})=>{if(g==="create"){const c=await P.collection("users").getOne(v.user);v.expand={user:c},e(1,r=[...r,v])}g==="delete"&&e(1,r=r.filter(c=>c.id!==v.id))})}),X(()=>{l==null||l()});async function d(){const o={text:i,user:a==null?void 0:a.id};await P.collection("messages").create(o),e(0,i="")}function h(){i=this.value,e(0,i)}return[i,r,d,h]}class oe extends z{constructor(s){super(),B(this,s,ie,re,H,{})}}function ce(u){let s,e;return s=new oe({}),{c(){Z(s.$$.fragment)},l(a){ee(s.$$.fragment,a)},m(a,i){te(s,a,i),e=!0},p:U,i(a){e||(se(s.$$.fragment,a),e=!0)},o(a){ae(s.$$.fragment,a),e=!1},d(a){le(s,a)}}}class pe extends z{constructor(s){super(),B(this,s,null,ce,H,{})}}export{pe as default};
